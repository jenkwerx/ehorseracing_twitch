<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mystery Box - MD5 Prize Game</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#ff6b6b;--accent2:#ffd166;--muted:#6b7280;--glass: rgba(255,255,255,0.04);}
  html,body{height:100%}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:radial-gradient(1200px 600px at 10% 10%, rgba(255,107,107,0.08), transparent 8%),radial-gradient(900px 400px at 90% 90%, rgba(255,209,102,0.06), transparent 6%),linear-gradient(180deg, #071021 0%, #071827 100%);color:#e6eef8;padding:120px 32px 32px 32px;overflow-y:auto;}
  .container{width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:22px;box-shadow: 0 10px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);display:grid;grid-template-columns: 1fr 0;gap:18px;transition:grid-template-columns 0.3s ease;margin:0 auto;}
  .container.game-active{grid-template-columns: 0 1fr;}
  header h1{margin:0 0 6px 0;font-size:20px;letter-spacing:0.4px;}
  header p{margin:0;color:var(--muted);font-size:13px}
  .left,   .right{background:var(--card); padding:18px; border-radius:12px;transition:opacity 0.3s ease;}
  .right.hidden{opacity:0;pointer-events:none;}
  .left{overflow:hidden;transition:opacity 0.3s ease;}
  .left.hidden{opacity:0;pointer-events:none;}
  textarea{width:100%;min-height:180px;background:var(--glass);color:inherit;border:1px dashed rgba(255,255,255,0.04);padding:12px;border-radius:8px;resize:vertical;font-size:14px;}
  .small {font-size:13px;color:var(--muted)}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600;box-shadow: 0 6px 18px rgba(2,6,23,0.6);}
  .btn-primary{background:linear-gradient(90deg,var(--accent),#ff8a8a);color:#071021;}
  .btn-ghost{background:transparent;color:var(--accent2);border:1px solid rgba(255,209,102,0.08);}
  .btn-black{background:#000;color:#ffd166;border:1px solid #ffd166;}
  .btn-blue{background:#1e40af;color:#fff;border:1px solid #3b82f6;}
  .controls{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  .right .items{display:grid;grid-template-columns: repeat(auto-fill,minmax(180px,1fr));gap:12px;}
  .item{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);transition:transform 220ms ease, box-shadow 220ms ease, opacity 240ms;position:relative;overflow:hidden;}
  .item:nth-child(6n+1){background:linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);color:#fff;}
  .item:nth-child(6n+2){background:linear-gradient(135deg, #7c2d12 0%, #ea580c 100%);color:#fff;}
  .item:nth-child(6n+3){background:linear-gradient(135deg, #166534 0%, #22c55e 100%);color:#fff;}
  .item:nth-child(6n+4){background:linear-gradient(135deg, #831843 0%, #ec4899 100%);color:#fff;}
  .item:nth-child(6n+5){background:linear-gradient(135deg, #4c1d95 0%, #a855f7 100%);color:#fff;}
  .item:nth-child(6n+6){background:linear-gradient(135deg, #115e59 0%, #14b8a6 100%);color:#fff;}
  .item .name{font-weight:700}
  .item .meta{font-size:12px;color:var(--muted);margin-top:6px}
  .highlight{transform:translateY(-6px) scale(1.02);box-shadow: 0 18px 40px rgba(255,209,102,0.3), 0 0 30px rgba(255,209,102,0.4);outline: 3px solid rgba(255,209,102,0.4);background:linear-gradient(180deg, rgba(255,209,102,0.25), rgba(255,107,107,0.15));animation: glow 0.3s ease-in-out;}
  @keyframes glow {0%, 100% { filter: brightness(1); }50% { filter: brightness(1.4); }}
  .removed{opacity:0.28;filter:grayscale(0.6);pointer-events:none;}
  .winner-banner{margin-top:0;padding:16px;border-radius:10px;background:linear-gradient(90deg,#2dffb0 0%, #6be7ff 100%);color:#052022;font-weight:800;box-shadow: 0 10px 40px rgba(45,255,176,0.4), 0 0 0 4px rgba(45,255,176,0.2);animation: slideDown 0.5s ease-out;}
  @keyframes slideDown {from { transform: translateY(-100px); opacity: 0; }to { transform: translateY(0); opacity: 1; }}
  .winner-details{display:grid;grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));gap:12px;margin-top:12px;}
  .winner-detail-card{background:rgba(5,32,34,0.3);padding:10px;border-radius:8px;}
  .winner-detail-label{font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.7;margin-bottom:4px;}
  .winner-detail-value{font-family:monospace;font-size:12px;word-break:break-all;}
  .hashbox{font-family:monospace;background:#071422;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-size:13px}
  .confetti-piece{position:fixed;z-index:9999;will-change:transform,opacity;width:10px;height:18px;opacity:0.9;pointer-events:none;transform-origin:center;}
  .muted-note{color:var(--muted);font-size:13px;margin-top:8px}
  .top-row{display:flex;gap:10px;align-items:center;justify-content:space-between}
  .brand{display:flex;gap:12px;align-items:center;}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ff8a8a,#ffd166);display:flex;align-items:center;justify-content:center;font-weight:900;color:#071021;box-shadow:0 6px 18px rgba(255,139,139,0.12);}
  footer.small{margin-top:10px;color:var(--muted);font-size:12px}
  @media(max-width:980px){.container{grid-template-columns:1fr; padding:12px}}
</style>
</head>
<body>
<div class="container" role="application" aria-label="Mystery Box game" id="mainContainer">
  <div class="left" id="leftPanel">
    <div class="top-row">
      <div class="brand">
        <div class="logo">MB</div>
        <div>
          <header>
            <h1>Mystery Box â€” MD5 Prize Game</h1>
            <p class="small">Enter items (one per line or comma-separated). Duplicates allowed. MD5 decides fairness.</p>
          </header>
        </div>
      </div>

    </div>
    <div style="margin-top:12px">
      <label class="small">Enter items</label>
      <textarea id="itemsInput" placeholder="Apple&#10;Golden Ticket&#10;$100&#10;Apple"></textarea>
      <div class="controls">
        <button class="btn btn-primary" id="buildBtn">Build Game</button>
      </div>
      <div class="muted-note">Tip: use duplicates for more interesting outcomes. Items are kept in the order you enter them.</div>
    </div>
  </div>
  <div class="right hidden" id="gameArea" aria-live="polite">
    <div id="idle" style="display:none">
      <h3 style="margin-top:0">Game preview</h3>
      <p class="small">No game built yet. Enter items on the left and click <strong>Build Game</strong>.</p>
    </div>
    <div id="playArea" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div>
          <h3 style="margin:0 0 6px 0">Items</h3>
          <div class="small">Click <strong>Pick Prize</strong> to lock a time salt and run the draw animation.</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <button class="btn btn-primary" id="pickBtn">Pick Prize</button>
          <button class="btn btn-ghost" id="resetBtn">Change List</button>
        </div>
      </div>
      <div style="margin-top:12px" id="itemsWrap">
        <div class="items" id="itemsGrid"></div>
      </div>
    </div>
  </div>
</div>
<div id="winnerBannerWrap" style="position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:10000;max-width:900px;width:calc(100% - 40px)"></div>
<script>
!function(n){"use strict";function d(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function f(n,t,r,e,o,u){return d((c=d(d(t,n),d(e,u)))<<(f=o)|c>>>32-f,r);var c,f}function l(n,t,r,e,o,u,c){return f(t&r|~t&e,n,t,o,u,c)}function g(n,t,r,e,o,u,c){return f(t&e|r&~e,n,t,o,u,c)}function v(n,t,r,e,o,u,c){return f(t^r^e,n,t,o,u,c)}function m(n,t,r,e,o,u,c){return f(r^(t|~e),n,t,o,u,c)}function i(n,r){n[r>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var t,i,o,u,c,f=1732584193,e=-271733879,h=-1732584194,a=271733878;for(t=0;t<n.length;t+=16)i=f,o=e,u=h,c=a,f=l(f,e,h,a,n[t],7,-680876936),a=l(a,f,e,h,n[t+1],12,-389564586),h=l(h,a,f,e,n[t+2],17,606105819),e=l(e,h,a,f,n[t+3],22,-1044525330),f=l(f,e,h,a,n[t+4],7,-176418897),a=l(a,f,e,h,n[t+5],12,1200080426),h=l(h,a,f,e,n[t+6],17,-1473231341),e=l(e,h,a,f,n[t+7],22,-45705983),f=l(f,e,h,a,n[t+8],7,1770035416),a=l(a,f,e,h,n[t+9],12,-1958414417),h=l(h,a,f,e,n[t+10],17,-42063),e=l(e,h,a,f,n[t+11],22,-1990404162),f=l(f,e,h,a,n[t+12],7,1804603682),a=l(a,f,e,h,n[t+13],12,-40341101),h=l(h,a,f,e,n[t+14],17,-1502002290),e=l(e,h,a,f,n[t+15],22,1236535329),f=g(f,e,h,a,n[t+1],5,-165796510),a=g(a,f,e,h,n[t+6],9,-1069501632),h=g(h,a,f,e,n[t+11],14,643717713),e=g(e,h,a,f,n[t],20,-373897302),f=g(f,e,h,a,n[t+5],5,-701558691),a=g(a,f,e,h,n[t+10],9,38016083),h=g(h,a,f,e,n[t+15],14,-660478335),e=g(e,h,a,f,n[t+4],20,-405537848),f=g(f,e,h,a,n[t+9],5,568446438),a=g(a,f,e,h,n[t+14],9,-1019803690),h=g(h,a,f,e,n[t+3],14,-187363961),e=g(e,h,a,f,n[t+8],20,1163531501),f=g(f,e,h,a,n[t+13],5,-1444681467),a=g(a,f,e,h,n[t+2],9,-51403784),h=g(h,a,f,e,n[t+7],14,1735328473),e=g(e,h,a,f,n[t+12],20,-1926607734),f=v(f,e,h,a,n[t+5],4,-378558),a=v(a,f,e,h,n[t+8],11,-2022574463),h=v(h,a,f,e,n[t+11],16,1839030562),e=v(e,h,a,f,n[t+14],23,-35309556),f=v(f,e,h,a,n[t+1],4,-1530992060),a=v(a,f,e,h,n[t+4],11,1272893353),h=v(h,a,f,e,n[t+7],16,-155497632),e=v(e,h,a,f,n[t+10],23,-1094730640),f=v(f,e,h,a,n[t+13],4,681279174),a=v(a,f,e,h,n[t],11,-358537222),h=v(h,a,f,e,n[t+3],16,-722521979),e=v(e,h,a,f,n[t+6],23,76029189),f=v(f,e,h,a,n[t+9],4,-640364487),a=v(a,f,e,h,n[t+12],11,-421815835),h=v(h,a,f,e,n[t+15],16,530742520),e=v(e,h,a,f,n[t+2],23,-995338651),f=m(f,e,h,a,n[t],6,-198630844),a=m(a,f,e,h,n[t+7],10,1126891415),h=m(h,a,f,e,n[t+14],15,-1416354905),e=m(e,h,a,f,n[t+5],21,-57434055),f=m(f,e,h,a,n[t+12],6,1700485571),a=m(a,f,e,h,n[t+3],10,-1894986606),h=m(h,a,f,e,n[t+10],15,-1051523),e=m(e,h,a,f,n[t+1],21,-2054922799),f=m(f,e,h,a,n[t+8],6,1873313359),a=m(a,f,e,h,n[t+15],10,-30611744),h=m(h,a,f,e,n[t+6],15,-1560198380),e=m(e,h,a,f,n[t+13],21,1309151649),f=m(f,e,h,a,n[t+4],6,-145523070),a=m(a,f,e,h,n[t+11],10,-1120210379),h=m(h,a,f,e,n[t+2],15,718787259),e=m(e,h,a,f,n[t+9],21,-343485551),f=d(f,i),e=d(e,r),h=d(h,o),a=d(a,u);return [f,e,h,a]}function a(n){for(var t="",r=32*n.length,e=0;e<r;e+=8) t+=String.fromCharCode(n[e>>5]>>>e%32&255);return t}function h(n){var t=[];for(t[(n.length>>2)-1]=void 0,e=0;e<t.length;e+=1)t[e]=0;for(var e=0;e<8*n.length;e+=8)t[e>>5]|=(255&n.charCodeAt(e/8))<<e%32;return t}function o(n){return a(i(h(n),8*n.length))}function md5(n){var i=o(n);var out="";for(var k=0;k<i.length;k++){out += i.charCodeAt(k).toString(16).padStart(2,"0")}return out}window.md5 = md5;}(this);
(function(){
  const itemsInput = document.getElementById('itemsInput');
  const buildBtn = document.getElementById('buildBtn');
  const sampleBtn = document.getElementById('sampleBtn');
  const idle = document.getElementById('idle');
  const playArea = document.getElementById('playArea');
  const itemsGrid = document.getElementById('itemsGrid');
  const pickBtn = document.getElementById('pickBtn');
  const resetBtn = document.getElementById('resetBtn');
  const winnerBannerWrap = document.getElementById('winnerBannerWrap');
  const downloadBtn = document.getElementById('downloadBtn');
  let rawItems = [];
  let items = [];
  let lockedSalt = null;
  let itemHashes = [];
  let predeterminedWinnerIndex = null;
  let isRunning = false;
  function parseItems(raw){const parts = raw.split(/\n|,/).map(s=>s.trim()).filter(s=>s.length>0);return parts;}
  function renderItems(){itemsGrid.innerHTML = '';items.forEach((it,idx)=>{const div = document.createElement('div');div.className = 'item' + (it.removed ? ' removed' : '');div.dataset.idx = idx;div.innerHTML = `<div class="name">${escapeHtml(it.name)}</div><div class="meta">#${idx+1}</div>`;itemsGrid.appendChild(div);});}
  function escapeHtml(s){ return s.replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }
  buildBtn.addEventListener('click',()=>{const parsed = parseItems(itemsInput.value || '');if(parsed.length===0){ alert('Please enter at least one item.'); return; }rawItems = parsed.slice();items = parsed.map((n,i)=>({name:n,index:i,removed:false}));lockedSalt = null;itemHashes = [];predeterminedWinnerIndex = null;winnerBannerWrap.innerHTML='';idle.style.display='none';playArea.style.display='block';renderItems();leftPanel.classList.add('hidden');mainContainer.classList.add('game-active');gameArea.classList.remove('hidden');});
  resetBtn.addEventListener('click',()=>{if(isRunning) return;itemsInput.value = rawItems.join('\n');idle.style.display='block';playArea.style.display='none';winnerBannerWrap.innerHTML='';items = [];itemHashes = [];lockedSalt = null;leftPanel.classList.remove('hidden');mainContainer.classList.remove('game-active');gameArea.classList.add('hidden');});
  function genTimeSalt(){const d = new Date();function pad(n){return String(n).padStart(2,'0')}const s = `${d.getFullYear()}_${pad(d.getMonth()+1)}_${pad(d.getDate())}_${pad(d.getHours())}_${pad(d.getMinutes())}_${pad(d.getSeconds())}`;return s;}
  function computeHashes(salt){const hashes = items.map(it=>{const payload = `${it.index+1}_${it.name}_${salt}`;return {index:it.index,name:it.name,hash:md5(payload)};});return hashes;}
  function computeAuditHash(hashes){const concat = hashes.map(h=>h.hash).join('');return md5(concat);}
  pickBtn.addEventListener('click', async ()=>{if(isRunning) return;if(items.length===0){ alert('No items'); return; }if(!items.some(it=>!it.removed)){ alert('No selectable items (all removed). Use "Redraw with All Items" or change the list.'); return; }isRunning = true;lockedSalt = genTimeSalt();itemHashes = computeHashes(lockedSalt);const candidates = itemHashes.filter(h=>!items[h.index].removed);let min = candidates[0];for(const c of candidates){ if(c.hash < min.hash) min = c; }predeterminedWinnerIndex = min.index;const activeCount = items.filter(it=>!it.removed).length;const totalTurns = Math.min(25, activeCount * 5);const selectableIndices = items.map((it,idx)=> it.removed ? null : idx).filter(x=>x!==null);const turns = [];for(let t=0;t<totalTurns-1;t++){const r = selectableIndices[Math.floor(Math.random()*selectableIndices.length)];turns.push(r);}turns.push(predeterminedWinnerIndex);const times = [];for(let t=0;t<totalTurns;t++){const p = t/(totalTurns-1);const delay = Math.round(15 + (1 - Math.pow(1 - p, 2)) * 300);times.push(delay);}let current = -1;for(let t=0;t<totalTurns;t++){const idx = turns[t];if(current>=0){const prev = itemsGrid.querySelector(`[data-idx="${current}"]`);if(prev) prev.classList.remove('highlight');}const el = itemsGrid.querySelector(`[data-idx="${idx}"]`);if(el) el.classList.add('highlight');current = idx;await wait(times[t]);}celebrateWinner(predeterminedWinnerIndex);isRunning = false;});
  function wait(ms){ return new Promise(res=>setTimeout(res, ms)); }
  function celebrateWinner(index){const winner = items[index];const winnerHashData = itemHashes.find(h=>h.index===index);const preHashInput = `${index+1}_${winner.name}_${lockedSalt}`;const banner = document.createElement('div');banner.className = 'winner-banner';banner.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;gap:10px"><div style="display:flex;align-items:center;gap:12px"><div style="font-size:20px">ðŸŽ‰</div><div><div style="font-size:15px">Winner</div><div style="font-size:18px;font-weight:900">${escapeHtml(winner.name)}</div></div></div><div style="text-align:right"><div style="font-size:12px;opacity:0.7">Index</div><div style="font-weight:800">#${index+1}</div></div></div><div class="winner-details"><div class="winner-detail-card"><div class="winner-detail-label">Time Salt</div><div class="winner-detail-value">${lockedSalt}</div></div><div class="winner-detail-card"><div class="winner-detail-label">Pre-Hash Input</div><div class="winner-detail-value">${escapeHtml(preHashInput)}</div></div><div class="winner-detail-card"><div class="winner-detail-label">Winner Hash (MD5)</div><div class="winner-detail-value">${winnerHashData.hash}</div></div></div><div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap"><button class="btn btn-primary" id="removeWinnerBtn">Remove Winner & Redraw</button><button class="btn btn-black" id="redrawBtn">Redraw with All Items</button><button class="btn btn-blue" id="changeListBtn">Change List</button></div>`;winnerBannerWrap.innerHTML = '';winnerBannerWrap.appendChild(banner);document.getElementById('removeWinnerBtn').addEventListener('click',()=>{items[index].removed = true;renderItems();winnerBannerWrap.innerHTML='';lockedSalt = null;itemHashes = [];predeterminedWinnerIndex = null;});document.getElementById('redrawBtn').addEventListener('click',()=>{items.forEach(it=>it.removed=false);renderItems();winnerBannerWrap.innerHTML='';lockedSalt = null;itemHashes = [];predeterminedWinnerIndex = null;});document.getElementById('changeListBtn').addEventListener('click',()=>{leftPanel.classList.remove('hidden');mainContainer.classList.remove('game-active');gameArea.classList.add('hidden');winnerBannerWrap.innerHTML='';itemsInput.value = rawItems.join('\n');idle.style.display='block';playArea.style.display='none';items = [];itemHashes = [];lockedSalt = null;});launchConfetti();}
  function launchConfetti(){const colors = ['#ff6b6b','#ffd166','#6be7ff','#8affc1','#d29bff','#ffd1f2'];for(let i=0;i<80;i++){const el = document.createElement('div');el.className='confetti-piece';el.style.left = (10 + Math.random()*80) + '%';el.style.top = (-10 - Math.random()*10) + '%';el.style.background = colors[Math.floor(Math.random()*colors.length)];el.style.transform = `rotate(${Math.random()*360}deg)`;document.body.appendChild(el);const fall = 1500 + Math.random()*2600;const sway = 60 + Math.random()*180;el.animate([{ transform: `translateY(0px) rotate(${Math.random()*360}deg)`, opacity:1 },{ transform: `translateY(${fall}px) translateX(${sway - Math.random()*sway}px) rotate(${Math.random()*720}deg)`, opacity:0.1 }], { duration: fall + 600, easing:'cubic-bezier(.2,.8,.2,1)'});setTimeout(()=>{ try{ el.remove(); }catch(e){} }, fall+650);}}
  itemsGrid.addEventListener('click',(e)=>{const it = e.target.closest('.item');if(!it) return;const idx = Number(it.dataset.idx);items[idx].removed = !items[idx].removed;renderItems();});
  function scrollIntoView(el){el.scrollIntoView({behavior:'smooth',block:'center'});}
  itemsInput.value = "Item 1\nItem 2\nItem 3\nItem 4\nItem 5\nItem 6\nItem 7\nItem 8";
})();
</script>
</body>
</html>